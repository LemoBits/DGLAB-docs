# 郊狼情趣脉冲主机 V2 蓝牙协议

## 蓝牙特性

| 服务UUID | 特性UUID | 属性 | 名称 | 大小(BYTE) |
| :------------: | :------------: | :------------: | :------------: | :------------: |
| 0x180A | 0x1500 | 读/通知 | Battery_Level | 1字节 |
| 0x180B | 0x1504 | 读/写/通知 | PWM_AB2 | 3字节 |
| 0x180B | 0x1505 | 读/写 | PWM_A34 | 3字节 |
| 0x180B | 0x1506 | 读/写 | PWM_B34 | 3字节 |

| 名称 | 说明 | 通信数据定义 |
| :------------: | :------------: | :------------: |
| Battery_Level | 设备当前电量 | 1byte(整数0-100) |
| PWM_AB2 | AB两通道强度 | 23-22bit(保留) 21-11bit(A通道实际强度) 10-0bit(B通道实际强度) |
| PWM_A34 | B通道波形数据 | 23-20bit(保留) 19-15bit(Az) 14-5bit(Ay) 4-0bit(Ax) |
| PWM_B34 | A通道波形数据 | 23-20bit(保留) 19-15bit(Bz) 14-5bit(By) 4-0bit(Bx) |

### 蓝牙名称

脉冲主机2.0 : D-LAB ESTIM01  
基础UUID: `955Axxxx-0FE2-F5AA-A094-84B8D4F3E8AD` (将xxxx替换为服务UUID)

## 基本原理

郊狼内置了两组独立的脉冲生成模块，分别对应A，B两个通道。每组脉冲生成模块又由电源模块和波形控制模块两部分构成。我们通过蓝牙协议中的S,X,Y,Z四个变量来控制脉冲生成模块。

### 电源模块 (S: PWM_AB2特性)

电源模块控制脉冲的电压，也就是通道的强度（App界面中圆环内的数字)，对应参数S，范围【0-2047】（不能超过2047）。APP 中每增加一点强度是增加7（实际强度值为APP显示值的7倍）。写入不同的 S 值时，通道强度会立刻改变并保持。

### 波形控制模块 (X Y Z)

> X: PWM_A34或PWM_B34中4-0bit的5bits数据  
> Y: PWM_A34或PWM_B34中14-5的10bits数据  
> Z: PWM_A34或PWM_B34中19-15的5bits数据

波形控制模块控制脉冲出现的规律以及脉冲宽度变化，保存为内置波形或自定义波形。

#### 脉冲规律控制

每秒分割成1000ms，每 ms 可产生一次脉冲。X 表示连续 X 毫秒发出 X 个脉冲，Y 表示 X 个脉冲后间隔 Y 毫秒再发出 X 个脉冲并循环。范围：X【0-31】，Y【0-1023】。

> e.g.  
> 【1,9】每隔9ms发1个脉冲，总耗时10ms，频率100hz。  
> 【5,95】每隔95ms发5个脉冲，总耗时100ms，五合一体感约10hz。

#### Frequency 值

```
Frequency = X + Y
脉冲真实频率 = Frequency / 1000
```

Frequency 取值(10~1000)。推荐比例：

```
X = ((Frequency / 1000)^ 0.5) * 15
Y = Frequency - X
```

当 X:Y > 1:9（如【8,2】）时，波形整体感受会变弱。

#### 脉冲宽度控制

一次脉冲由两个对称的正负单极性脉冲组成，高度由通道强度决定。通过控制脉冲宽度（Z）调整体感；Z 范围【0-31】，实际宽度=Z*5us。Z>20 时更易刺痛。

#### 创造不断变化的波形

每组【X,Y,Z】仅在 0.1s 内有效；若需持续输出，需每隔0.1s 发送一次。

- Tips: 可每0.1s 修改 Frequency，利用公式自动生成 X、Y。

更多例子：

- 频率不断变快：  
  【5,135,20】【5,125,20】【5,115,20】【5,105,20】【5,95,20】【4,86,20】【4,76,20】【4,66,20】【3,57,20】【3,47,20】【3,37,20】【2,28,20】【2,18,20】【1,14,20】【1,9,20】
- 两个频率间切换：  
  【5,95,20】【5,95,20】【5,95,20】【5,95,20】【5,95,20】【1,9,20】【1,9】【1,9,20】【1,9,20】【1,9,20】
- 频率不变但“推力”感：  
  【1,9,4】【1,9,8】【1,9,12】【1,9,16】【1,9,18】【1,9,19】【1,9,20】【1,9,0】【1,9,0】【1,9,0】

- Tips: 人体对频率变化感受较慢，频率变化过快无法形成节奏感；脉冲宽度的频繁变化可创造多样感觉。

## 补充提示

- V2 波形强度与 V3 映射关系：`(V2 波形强度 20) ≈ (V3 波形强度 100)`。
- 输出窗口：每 0.1s 一组，保持节奏写入可保证连续体验。
